<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>대순진리회 소통의 광장</title>
  <meta name="description" content="대순진리회 소통의 광장 — 공지 및 게시판" />
  <style>
    :root {
      --bg: #0b1020; --card: #121a32; --muted: #94a3b8; --text: #e5e7eb;
      --accent: #4f46e5; --accent-2: #22d3ee; --ring: rgba(34,211,238,.35);
      --shadow: 0 20px 45px rgba(0,0,0,.35); --radius: 20px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Noto Sans KR', sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 600px at 10% 0%, rgba(79,70,229,.25), transparent 60%),
                  radial-gradient(1000px 600px at 90% 0%, rgba(34,211,238,.2), transparent 60%),
                  var(--bg);
      line-height: 1.6;
    }
    header {
      position: sticky; top: 0; z-index: 10;
      backdrop-filter: blur(8px);
      background: rgba(11,16,32,.85);
      border-bottom: 1px solid rgba(99,102,241,.2);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    .title { font-weight: 800; letter-spacing: -0.02em; font-size: 22px; }
    .muted { color: var(--muted); }
    .card {
      background: rgba(18,26,50,.9);
      border: 1px solid rgba(148,163,184,.15);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-top: 24px;
    }
    .card .inner { padding: 24px; }
    h1,h2,h3 { margin: 0 0 12px; }
    .list { list-style: none; padding: 0; margin: 0; display: grid; gap: 12px; }
    .item { border: 1px solid rgba(148,163,184,.18); border-radius: 12px; padding: 12px 16px; background: rgba(255,255,255,.02); }
    .board-row { display: flex; align-items: center; gap: 10px; }
    .board-no { background: rgba(34,211,238,.15); border: 1px solid rgba(34,211,238,.3); color: #a5f3fc; border-radius: 8px; padding: 4px 8px; font-size: 12px; }
    .board-title { cursor: pointer; font-weight: 700; color: #e0e7ff; }
    .board-title:hover { text-decoration: underline; }
    .board-meta { margin-left: auto; font-size: 12px; color: var(--muted); }
    .board-body { display: none; margin-top: 10px; color: #cbd5e1; white-space: pre-line; }
    .page-btn { border: 1px solid rgba(148,163,184,.25); background: rgba(255,255,255,.03); padding: 6px 10px; border-radius: 10px; cursor: pointer; }
    .page-btn[aria-current="page"] { border-color: #22d3ee; font-weight: 700; }
    .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 16px; }
    footer { text-align: center; color: var(--muted); font-size: 14px; margin: 40px 0; }
  </style>
</head>
<body>
<header>
  <div class="container">
    <div class="title">대순진리회 소통의 광장</div>
  </div>
</header>

<main class="container">
  <!-- 공지 -->
  <section class="card">
    <div class="inner">
      <h2>공지</h2>
      <ul id="noticeList" class="list"></ul>
      <div id="noticeEmpty" class="muted">등록된 공지가 없습니다.</div>
    </div>
  </section>

  <!-- 게시판 -->
  <section class="card">
    <div class="inner">
      <h2>게시판</h2>
      <ul id="boardList" class="list"></ul>
      <div id="boardEmpty" class="muted">등록된 게시글이 없습니다.</div>
      <nav id="pagination" class="pagination"></nav>
    </div>
  </section>
</main>

<footer>© 2025 대순진리회 소통의 광장</footer>

<script type="module">
import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

// Firebase 설정
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
const db = getFirestore(app);

const fmt = (ts) => ts?.toDate ? ts.toDate().toLocaleString("ko-KR", { dateStyle: "medium", timeStyle: "short" }) : "";

/* -------------------- 공지 -------------------- */
const noticesRef = collection(db, "notices");
const noticeUl = document.getElementById("noticeList");
const noticeEmpty = document.getElementById("noticeEmpty");

onSnapshot(query(noticesRef, orderBy("createdAt","desc")), (snap) => {
  noticeUl.innerHTML = "";
  if (snap.empty) { noticeEmpty.style.display = "block"; return; }
  noticeEmpty.style.display = "none";
  snap.forEach(doc => {
    const n = doc.data();
    const li = document.createElement("li");
    li.className = "item";
    const titleDiv = document.createElement("div");
    titleDiv.className = "board-row";
    titleDiv.innerHTML = `
      <div class="board-no">공지</div>
      <div class="board-title">${n.title}</div>
      <div class="board-meta">${fmt(n.createdAt)}</div>
    `;
    const bodyDiv = document.createElement("div");
    bodyDiv.className = "board-body";
    bodyDiv.innerHTML = (n.body || "").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("\n","<br>");
    titleDiv.querySelector(".board-title").addEventListener("click", () => {
      bodyDiv.style.display = bodyDiv.style.display === "block" ? "none" : "block";
    });
    li.appendChild(titleDiv);
    li.appendChild(bodyDiv);
    noticeUl.appendChild(li);
  });
});

/* -------------------- 게시판 -------------------- */
const postsRef = collection(db, "posts");
const postUl = document.getElementById("boardList");
const boardEmpty = document.getElementById("boardEmpty");
const pagination = document.getElementById("pagination");

let allPosts = [];
let currentPage = 1;
const PAGE_SIZE = 5;

function renderPage(page = 1) {
  postUl.innerHTML = "";
  const start = (page - 1) * PAGE_SIZE;
  const pagePosts = allPosts.slice(start, start + PAGE_SIZE);
  if (pagePosts.length === 0) { boardEmpty.style.display = "block"; return; }
  boardEmpty.style.display = "none";
  pagePosts.forEach((p, idx) => {
    const li = document.createElement("li");
    li.className = "item";
    const row = document.createElement("div");
    row.className = "board-row";
    row.innerHTML = `
      <div class="board-no">${allPosts.length - (start + idx)}</div>
      <div class="board-title">${p.title}</div>
      <div class="board-meta">${p.author || "익명"} · ${fmt(p.createdAt)}</div>`;
    const body = document.createElement("div");
    body.className = "board-body";
    body.innerHTML = (p.body || "").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("\n","<br>");
    row.querySelector(".board-title").addEventListener("click", () => {
      body.style.display = body.style.display === "block" ? "none" : "block";
    });
    li.appendChild(row);
    li.appendChild(body);
    postUl.appendChild(li);
  });
  renderPagination(page);
}

function renderPagination(page) {
  pagination.innerHTML = "";
  const totalPages = Math.ceil(allPosts.length / PAGE_SIZE);
  for (let i = 1; i <= totalPages; i++) {
    const btn = document.createElement("button");
    btn.className = "page-btn";
    btn.textContent = i;
    if (i === page) btn.setAttribute("aria-current", "page");
    btn.addEventListener("click", () => { currentPage = i; renderPage(i); });
    pagination.appendChild(btn);
  }
}

onSnapshot(query(postsRef, orderBy("createdAt","desc")), (snap) => {
  allPosts = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  renderPage(1);
});
</script>
</body>
</html>